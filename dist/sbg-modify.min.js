const version="1.5.0";const presets={};presets["common"]={enabled:[enableBackButton,autoUpdateLangCache]};presets["nicoscript"]={enabled:[...presets["common"].enabled,fixCompatibility,loadCUI,fixGotoReference]};presets["egorscript"]={enabled:[...presets["common"].enabled,loadEUI]};presets["allscripts"]={enabled:[...presets["nicoscript"].enabled,...presets["egorscript"].enabled,restoreCUISort]};presets["oldwebview"]={enabled:[...presets["allscripts"].enabled,forceCenterPopups,disableClusters]};presets["hot"]={disabled:[enableFreeze,forceCenterPopups,quickToggleInfoButtons]};presets["full"]={disabled:[forceCenterPopups]};const features=[{ev:"",func:loadCUI},{ev:"sbgCUILoad",func:fixCompatibility},{ev:"sbgCUILoad",func:disableClusters},{ev:"sbgCUILoad",func:alwaysCleanInventory},{ev:"sbgCUILoad",func:fixGotoReference},{ev:"sbgCUIInit",func:makeSplideInstant,requires:"Splide"},{ev:"sbgCUIInit",func:makeToasts1sec,requires:"Toastify"},{ev:"sbgCUIReady",func:disablePopupAnimation,requires:".popup"},{ev:"sbgCUIReady",func:loadEUI,requires:"egorScript"},{ev:"sbgCUIReady",func:enableBackButton},{ev:"sbgCUIReady",func:autoUpdateLangCache},{ev:"sbgCUIReady",func:forceCenterPopups,requires:".popup.pp-center"},{ev:"sbgCUIReady",func:enableFireEnhancements,requires:"#attack-menu"},{ev:"sbgCUIReady",func:alwaysCenterFireItemsCount,requires:"#attack-slider"},{ev:"sbgCUIInitFire",func:makeHighlevelLabelOverlay,requires:"#attack-slider"},{ev:"sbgCUIInitFire",func:makeCentralButtonFire,requires:"#attack-menu"},{ev:"sbgCUIReady",func:showQuickAutoSelectButton,requires:".sbgcui_toolbar"},{ev:"sbgCUIReady",func:alwaysShowCUIToolbar,requires:".sbgcui_toolbar"},{ev:"sbgCUIReady",func:moveCUIToolbarRight,requires:".sbgcui_toolbar-control"},{ev:"sbgCUIReady",func:alwaysShowCompass,requires:".ol-compass"},{ev:"sbgCUIReady",func:enableFreeze,requires:"#toggle-follow"},{ev:"sbgCUIReady",func:autoDeleteFromInventory,requires:".inventory.popup"},{ev:"sbgCUIReady",func:hideManualClearButtons,requires:".inventory__content"},{ev:"sbgCUIReady",func:showSelfStatsOnLeaderboard,requires:"__sbg_function_drawLeaderboard"},{ev:"sbgCUIReady",func:restoreCUISort,requires:".inventory__content"},{ev:"sbgCUIReady",func:quickRecycleRefs,requires:".inventory__content"},{ev:"sbgCUIReady",func:makeInfoPopupSemiTransparent,requires:".info.popup"},{ev:"sbgCUIReady",func:clearInventoryAfterDiscover,requires:"#discover"},{ev:"sbgCUIReady",func:showSecondsForCoolDowns,requires:"__sbg_function_timeToString"},{ev:"sbgCUIReady",func:increaseItemsFont,requires:".info.popup"},{ev:"sbgCUIReady",func:enlargeCoreSlots,requires:".info.popup"},{ev:"sbgCUIReady",func:alignCloseButton,requires:".info.popup > .popup-close"},{ev:"sbgCUIReady",func:hideCloseButton,requires:".popup-close, #inventory__close"},{ev:"sbgCUIReady",func:hideRechargeButton,requires:".info.popup"},{ev:"sbgCUIReady",func:replaceSwipeWithButton,requires:".sbgcui_swipe-cards-arrow"},{ev:"sbgCUIReady",func:quickToggleInfoButtons,requires:".info.popup .i-image-box"},{ev:"sbgCUIReady",func:drawClickPointsToSelect,requires:"__sbg_function_showInfo"},{ev:"sbgCUIReady",func:highlightTargetDrawPoint,requires:"__sbg_constant_map"},{ev:"sbgCUIReady",func:beautifyDrawSliderSort,requires:".draw-slider-wrp"}];(append=>{Element.prototype.append=function(){if(arguments.length===0){return}if(arguments[0].src=="https://3d.sytes.net/script.js"){Array.prototype.shift.apply(arguments)}append.apply(this,arguments)}})(Element.prototype.append);((addEventListener,removeEventListener)=>{EventTarget.prototype.addEventListener=function(ev,listener){this.__events=this.__events||{};this.__events[ev]=this.__events[ev]||[];this.__events[ev].push(listener);addEventListener.apply(this,arguments)};EventTarget.prototype.removeEventListener=function(ev,listener){this.__events=this.__events||{};this.__events[ev]=this.__events[ev]||[];const index=this.__events[ev].indexOf(listener);if(index!==-1){this.__events[ev].splice(index,1)}removeEventListener.apply(this,arguments)}})(EventTarget.prototype.addEventListener,EventTarget.prototype.removeEventListener);window.modifyNativeScript=function(data){console.debug("11 - modify native script");const expose_constants={readable:["map","units","LANG","temp_lines_source","draw_slider"],writable:["ItemTypes"]};const expose_functions={readable:["apiQuery","jquerypassargs","openProfile","deleteInventoryItem"],writable:["movePlayer","timeToString","drawLeaderboard","showInfo","manageDrawing"]};const expose_variables={readable:["VERSION"],writable:[]};window.__sbg_script_original=data;data=data.replace(/(?:^|\n)\s*const\s+(\w+)\s+/g,((text,constantName)=>{if(expose_constants.readable.includes(constantName)){return`${text}= window.__sbg_constant_${constantName} `}if(expose_constants.writable.includes(constantName)){return`${text}= new Proxy({}, { get(obj, prop) {\n\treturn window.__sbg_constant_${constantName}[prop]; \n }}); \nwindow.__sbg_constant_${constantName} `}return text}));data=data.replace(/(?:^|\n)\s*(async\s+)?function\s+(\w+)\s*\((.*?)\)\s*\{/g,((text,async,functionName,args)=>{async=async||"";if(expose_functions.readable.includes(functionName)){return`\nwindow.__sbg_function_${functionName} = ${functionName};\n${text}`}if(expose_functions.writable.includes(functionName)){return`${text}\n\treturn window.__sbg_function_${functionName}(...arguments);\n}\nwindow.__sbg_function_${functionName} = ${async}function(${args}) {`}return text}));data=data.replace(/(^|\n)\s*let\s+(\w+)(?=[\s+,\n$])/g,((text,before,variableName)=>{if(expose_variables.readable.includes(variableName)){return`${before}window.__sbg_variable_${variableName} = () => ${variableName}; ${text}`}if(expose_variables.writable.includes(variableName)){return`${before}window.__sbg_variable_${variableName} = (value) => { if (value !== undefined) { ${variableName} = value; } else { value = ${variableName}; } return value; }; ${text}`}return text}));window.__sbg_script_modified=data;return data};window.runOnceWhenLoaded=function(func){let loaded=false;function runOnce(){if(loaded)return;loaded=true;func()}document.addEventListener("DOMContentLoaded",(()=>{console.debug("5 - run once from listener");runOnce()}));console.debug('document.readyState = "'+document.readyState+'"');if(document.readyState!=="loading"){console.debug("5 - run once from checking readyState");runOnce()}};document.addEventListener("DOMContentLoaded",(()=>{console.debug("DOMContentLoaded fired!")}));function isEnabled(func){const preset=presets[window.__sbg_preset];if(preset.enabled){return preset.enabled.includes(func)}if(preset.disabled){return!preset.disabled.includes(func)}return true}function execFeature({func:func,requires:requires}){const logCommand="exec";const logOffset=" ".repeat(logCommand.length+1);console.log(`${logCommand} ${func.name}`);let arg;if(requires){arg=$(requires);if(arg.length===0){arg=window[requires]}if(!arg){console.error(`${logOffset}${func.name} - error: cannot find ${requires}`);return}}let result=undefined;if(window.__sbg_local){result=func.call(null,arg)}else{try{result=func.call(null,arg)}catch(ex){console.error(`${logOffset}${func.name} - error: ${ex.toString()}`);return}}console.debug(`${logOffset}${func.name} - done!`);return result}features.map((({ev:ev,func:func,requires:requires})=>{if(!isEnabled(func))return;if(ev){window.addEventListener(ev,(()=>execFeature({func:func,requires:requires})))}else{return execFeature({func:func,requires:requires})}}));if(!isEnabled(loadCUI)){console.debug("0 - do not fetch nicko script");window.runOnceWhenLoaded((()=>{console.debug("6 - fire sbgCUIInit");window.dispatchEvent(new CustomEvent("sbgCUIInit"));console.debug("10 - load main script");loadModifiedScript("/script.js",window.modifyNativeScript).then(waitForSbgCUIReady)}))}function loadScript(src){const script=document.createElement("script");script.type="text/javascript";script.src=src;document.head.appendChild(script)}async function loadModifiedScript(src,modifier){return fetch(src).then((r=>r.text())).then((data=>{const script=document.createElement("script");script.type="text/javascript";script.textContent=modifier(data);document.head.appendChild(script)}))}function setCSS(css){$("<style></style>").html(css).appendTo(document.body)}function waitForSbgCUIReady(){console.debug("15 - wait for map object");const waitForMap=setInterval((()=>{if(!("__sbg_constant_map"in window))return;clearInterval(waitForMap);console.debug("16 - map object appeared");console.debug(window.__sbg_constant_map);console.debug("17 - fire sbgCUIReady");window.dispatchEvent(new CustomEvent("sbgCUIReady"))}),50)}function replaceNickoFunction(data,comment,callback){const regex=new RegExp(`(\\/\\*\\s*${comment.regexEscape()}.*?\n)(\\s*)(\\{.*?\n)(\\s*)((.|\n)*?)(\n\\2\\})`,"im");return data.replace(regex,(($0,comment,space1,opened,space2,body,$6,closed)=>comment+space1+opened+space2+callback(body)+closed))}String.prototype.regexEscape=function(){return this.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};function loadCUI(){console.debug("0 - fetch nicko script");loadModifiedScript("https://raw.githubusercontent.com/nicko-v/sbg-cui/main/index.js",(data=>{console.debug("1 - modify nicko script");window.__sbg_cui_script_original=data;features.filter((({ev:ev})=>ev==="sbgCUILoad")).forEach((({func:func})=>data=func(data)));window.__sbg_cui_script_modified=data;console.debug("3 - load nicko script");return data}))}function fixCompatibility(data){console.debug("2 - fix compatibility");const prefix="__sbg_cui_";const fn_olInjection="olInjection";const fn_loadMainScript="loadMainScript";const fn_main="main";const cuiFunctions=[fn_olInjection,fn_loadMainScript,fn_main];window.addEventListener("sbgCUIInit",(()=>{console.debug("7 - should load nicko functions");const olWait=setInterval((()=>{if(typeof ol===undefined)return;clearInterval(olWait);console.debug("8 - open layer available");window.addEventListener("mapReady",(()=>{console.debug("12 - map constructed");console.debug("13 - main begin");window[`${prefix}${fn_main}`]().then((()=>{console.debug("14 - main end");waitForSbgCUIReady()})).catch((()=>{console.error("14 - main error");waitForSbgCUIReady()}))}));console.debug("9 - call olInjection");window[`${prefix}${fn_olInjection}`]();console.debug("10 - call loadMainScript");window[`${prefix}${fn_loadMainScript}`]()}),100)}));data=data.replace(`script.textContent = data`,`script.textContent = window.modifyNativeScript(data);`).replace(`window.stop`,`// window.stop`).replace(`fetch('/')`,`if (false) fetch('/')`).replace(/$/,`console.debug('4 - loaded nicko script');\n\t\t\twindow.runOnceWhenLoaded(() => {\n\t\t\t\tconsole.debug('6 - fire sbgCUIInit');\n\t\t\t\twindow.dispatchEvent(new CustomEvent('sbgCUIInit'));\n\t\t\t});`);cuiFunctions.forEach((fn=>data=data.replace(new RegExp(`((async )?function (${fn}))`),`window.${prefix}$3 = $3; $1`)));return data}function disableClusters(data){return data.replace(`function mapClickHandler(event) {`,`function mapClickHandler(event) { event.isSilent = true;`)}function alwaysCleanInventory(data){return data.replace(/const MIN_FREE_SPACE = \d+/,"const MIN_FREE_SPACE = INVENTORY_LIMIT")}function fixGotoReference(data){window.addEventListener("sbgCUIReady",(()=>{$(document).on("click",'a[href*="point="]',(ev=>{const guid=ev.currentTarget.href.split("point=").pop().split("&").shift();window.__sbg_function_showInfo(guid);ev.stopPropagation();return false}))}));return data.replace("window.location.href = `/?point=${guid}`","window.__sbg_function_showInfo(guid)")}function makeSplideInstant(){Splide.defaults=Splide.defaults||{};Splide.defaults.speed=0}function makeToasts1sec(){(_init=>{Toastify.prototype.init=function(options){if(!options.forceDuration){options.duration=Math.min(options.duration||0,1e3)}_init.call(this,options);return this};Toastify.prototype.init.prototype=_init.prototype})(Toastify.prototype.init)}function disablePopupAnimation(){setCSS(`\n\t\t.popup {\n\t\t\ttransition: none !important;\n\t\t}\n\t`)}function loadEUI(script){console.debug("18 - load egor script");window.cuiStatus="loaded";script()}function enableBackButton(){const backClickTimeout=1e3;let shouldExitOnBackClick=false;const popups=[{hiddenClass:"hidden",selectors:[".popup",".draw-slider-wrp",".attack-slider-wrp"]},{hiddenClass:"sbgcui_hidden",selectors:[".sbgcui_settings"]}];function isPopupClosed(){for(const{hiddenClass:hiddenClass,selectors:selectors}of popups){for(const selector of selectors){if(!$(selector).hasClass(hiddenClass)){$(selector).addClass(hiddenClass);if(selector===".draw-slider-wrp"){$("#draw-slider-close").click()}if(selector===".attack-slider-wrp"){$("#attack-menu").removeClass("sbgcui_attack-menu-rotate")}return true}}}return false}document.addEventListener("backbutton",(()=>{if(isPopupClosed()){shouldExitOnBackClick=false;return}if(shouldExitOnBackClick){location.replace("/window.close")}else{Toastify({text:'Нажмите кнопку "Назад" ещё раз\nдля выхода из игры',duration:backClickTimeout,forceDuration:true,gravity:"top",position:"right",className:"interaction-toast"}).showToast();shouldExitOnBackClick=true;setTimeout((()=>{shouldExitOnBackClick=false}),backClickTimeout)}}))}function forceCenterPopups(){setCSS(`\n\t\t@media (max-width: 425px) {\n\t\t\t.popup.pp-center {\n\t\t\t\ttop: 0 !important;\n\t\t\t\tleft: 0 !important;\n\t\t\t\ttranslate: none !important;\n\t\t\t}\n\t\t}\n\t`)}function enableFireEnhancements(attackMenu){let fireButtonCustomized=false;attackMenu.on("click",(ev=>{if(!fireButtonCustomized){fireButtonCustomized=true;window.dispatchEvent(new CustomEvent("sbgCUIInitFire"))}}))}function alwaysCenterFireItemsCount(){setCSS(`\n\t.splide__slide[data-rarity] .catalysers-list__amount {\n\t\tdisplay: block !important;\n\t}\n\t.splide__slide[data-rarity] .catalysers-list__amount:before {\n\t\tcontent: '';\n\t\tdisplay: inline-block;\n\t\tbackground: currentColor;\n\t\twidth: 1em;\n\t\theight: 1em;\n\t\tposition: absolute;\n\t\tright: 8px;\n\t\tfont-size: 0.85em;\n\t\tbottom: 5px;\n\t}\n\t`)}function makeHighlevelLabelOverlay(attackSlider){const sliderHeight=attackSlider.height();setCSS(`\n\t\t#attack-slider {\n\t\t\tpadding: 4px 0;\n\t\t}\n\n\t\t.attack-slider-highlevel {\n\t\t\tpointer-events: none;\n\t\t\tfont-size: 36px;\n\t\t\twidth: 1px;\n\t\t\theight: ${sliderHeight}px;\n\t\t\tmargin: -${sliderHeight}px auto 0 auto;\n\t\t\tbackground: none;\n\t\t\tbackdrop-filter: none;\n\t\t\t-webkit-backdrop-filter: none;\n\t\t\ttext-align: center;\n\t\t\tdisplay: block;\n\t\t\tz-index: 1;\n\t\t}\n\t`);$(".attack-slider-highlevel").html("&#x20e0")}function makeCentralButtonFire(attackMenu){const menuHeight=attackMenu.outerHeight();setCSS(`\n\t\t.attack-slider-wrp {\n\t\t\tmargin-bottom: -${menuHeight}px;\n\t\t\ttransition: none;\n\t\t}\n\n\t\t#attack-slider-fire {\n\t\t\tmax-width: ${menuHeight}px;\n\t\t\theight: ${menuHeight}px;\n\t\t\topacity: 0;\n\t\t}\n\n\t\t#attack-menu.sbgcui_attack-menu-rotate::after {\n\t\t\tbackground: var(--ingress-selection-color);\n\t\t}\n\n\t\t#attack-menu.sbgcui_attack-menu-rotate {\n\t\t\tborder-color: var(--ingress-selection-color);\n\t\t}\n\t`);$(window).click((function(ev){if(ev.target.id!=="attack-menu"&&$(".attack-slider-wrp.hidden").length===0&&$(ev.target).parents(".attack-slider-wrp").length===0){$("#attack-menu").click()}}))}function showQuickAutoSelectButton(toolbar){const autoSelect=JSON.parse(localStorage.getItem("sbgcui_config")).autoSelect;const cssClass=autoSelect.deploy==="max"?"fa-rotate-180":"";const autoSelectButton=$("<button></button>").addClass("fa fa-solid-arrow-down-short-wide").addClass(cssClass).appendTo(toolbar.parent());autoSelectButton.click((()=>{autoSelectButton.toggleClass("fa-rotate-180");const isMax=autoSelectButton.hasClass("fa-rotate-180");$('select[name="autoSelect_deploy"]').val(isMax?"max":"min");$('select[name="autoSelect_upgrade"]').val(isMax?"max":"min");$('form.sbgcui_settings button:contains("Сохранить")').click()}));setCSS(`\n\t\t.fa-rotate-180 {\n\t\t\ttransform: scale(-1, 1);\n\t\t}\n\t`)}function alwaysShowCUIToolbar(){setCSS(`\n\t\t.sbgcui_toolbar {\n\t\t\tdisplay: block !important;\n\t\t}\n\n\t\t.sbgcui_toolbar + button {\n\t\t\tdisplay: none !important;\n\t\t}\n\t`)}function moveCUIToolbarRight(control){control.children().prependTo($(".ol-control").first())}function alwaysShowCompass(compass){compass.addClass("fa fa-solid-location-arrow").html("");setCSS(`\n\t\t.ol-compass {\n\t\t\theight: 100%;\n\t\t}\n\t\t.ol-rotate {\n\t\t\tmargin-top: 0 !important;\n\t\t}\n\t\t.ol-rotate.ol-hidden {\n\t\t\topacity: 1 !important;\n\t\t\tvisibility: visible !important;\n\t\t\tmargin-top: 0;\n\t\t}\n\n\t\t.fa-solid-location-arrow {\n\t\t\t--fa-url: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' viewBox='-48 0 512 512'%3E%3Cpath d='M429.6 92.1c4.9-11.9 2.1-25.6-7-34.7s-22.8-11.9-34.7-7l-352 144c-14.2 5.8-22.2 20.8-19.3 35.8s16.1 25.8 31.4 25.8H224V432c0 15.3 10.8 28.4 25.8 31.4s30-5.1 35.8-19.3l144-352z'/%3E%3C/svg%3E");\n\t\t}\n\n\t\t.fa-solid-location-arrow:before {\n\t\t\ttransform: rotate(-45deg);\n\t\t\tdisplay: block;\n\t\t\tposition: relative;\n\t\t\ttop: 4px;\n\t\t\tfont-size: 0.9em;\n\t\t}\n\t`)}function enableFreeze(toggle){let frozen=false;const freezeButton=$("<button></button>").addClass("fa fa-solid-person-walking").appendTo(toggle.parent());freezeButton.click((()=>{freezeButton.toggleClass("fa-solid-person").toggleClass("fa-solid-person-walking");frozen=freezeButton.hasClass("fa-solid-person")}));(movePlayer=>{window.__sbg_function_movePlayer=function(){if(!frozen)movePlayer(...arguments)}})(window.__sbg_function_movePlayer);setCSS(`\n\t\t.fa-solid-person {\n\t\t\t--fa-url: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' viewBox='-96 0 512 512'%3E%3Cpath d='M112 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm40 304V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V256.9L59.4 304.5c-9.1 15.1-28.8 20-43.9 10.9s-20-28.8-10.9-43.9l58.3-97c17.4-28.9 48.6-46.6 82.3-46.6h29.7c33.7 0 64.9 17.7 82.3 46.6l58.3 97c9.1 15.1 4.2 34.8-10.9 43.9s-34.8 4.2-43.9-10.9L232 256.9V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V352H152z'/%3E%3C/svg%3E");\n\t\t}\n\n\t\t.fa-solid-person-walking {\n\t\t\t--fa-url: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' viewBox='-96 0 512 512'%3E%3Cpath d='M160 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zM126.5 199.3c-1 .4-1.9 .8-2.9 1.2l-8 3.5c-16.4 7.3-29 21.2-34.7 38.2l-2.6 7.8c-5.6 16.8-23.7 25.8-40.5 20.2s-25.8-23.7-20.2-40.5l2.6-7.8c11.4-34.1 36.6-61.9 69.4-76.5l8-3.5c20.8-9.2 43.3-14 66.1-14c44.6 0 84.8 26.8 101.9 67.9L281 232.7l21.4 10.7c15.8 7.9 22.2 27.1 14.3 42.9s-27.1 22.2-42.9 14.3L247 287.3c-10.3-5.2-18.4-13.8-22.8-24.5l-9.6-23-19.3 65.5 49.5 54c5.4 5.9 9.2 13 11.2 20.8l23 92.1c4.3 17.1-6.1 34.5-23.3 38.8s-34.5-6.1-38.8-23.3l-22-88.1-70.7-77.1c-14.8-16.1-20.3-38.6-14.7-59.7l16.9-63.5zM68.7 398l25-62.4c2.1 3 4.5 5.8 7 8.6l40.7 44.4-14.5 36.2c-2.4 6-6 11.5-10.6 16.1L54.6 502.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L68.7 398z'/%3E%3C/svg%3E");\n\t\t}\n\t`)}function autoDeleteFromInventory(inventoryPopup){$("<button></button>").text("Auto-delete").css({height:"40px"}).appendTo(inventoryPopup).click((()=>{$("#inventory__close").trigger("click");$(".sbgcui_settings").removeClass("sbgcui_hidden");$('.sbgcui_settings-title:contains("Автоудаление")').click()}))}function hideManualClearButtons(){setCSS(`\n\t\t.inventory__controls {\n\t\t\theight: 0;\n\t\t\tmin-height: 0;\n\t\t\toverflow: hidden;\n\t\t}\n\n\t\t.inventory__content[data-tab="3"] ~ .inventory__controls > select {\n\t\t\tposition: fixed;\n\t\t\tright: 0;\n\t\t\tbottom: 51px;\n\t\t\theight: 40px;\n\t\t\tflex-grow: 0;\n\t\t\tflex-shrink: 0;\n\t\t\tmargin: 0 4px;\n\t\t\twidth: calc(100% - 8px);\n\t\t\ttext-align: center;\n\t\t}\n\n\t\t.inventory__content[data-tab="3"] ~ .inventory__controls > .sbgcui_refs-sort-button {\n\t\t\tborder-width: revert;\n\t\t\tborder-radius: 0;\n\t\t\tbottom: 51px;\n\t\t\tz-index: 2;\n\t\t\tright: 4px;\n\t\t\theight: 40px;\n\t\t\twidth: 40px;\n\t\t\tfont-size: 20px;\n\t\t}\n\n\t\t#inventory__close {\n\t\t\tbottom: 102px;\n\t\t}\n\n\t\t.inventory__content[data-tab="3"] {\n\t\t\tmargin-bottom: 41px;\n\t\t}\n\t`)}function showSelfStatsOnLeaderboard(){(drawLeaderboard=>{window.__sbg_function_drawLeaderboard=async function(){await drawLeaderboard(...arguments);const statMap={owned:"owned_points"};const stat=$("#leaderboard__term-select").val();const unit=window.__sbg_constant_units.find((f=>f[0].test(stat)))[1];const formatter=new Intl.NumberFormat(window.__sbg_constant_LANG);const data=(await window.__sbg_function_apiQuery("profile",{guid:$("#self-info__name").data("guid")})).response.data;const value=data[statMap[stat]||stat];const entry=window.__sbg_function_jquerypassargs($("<li>"),"$1$ — $2$; $3$ $4$",$("<span>",{class:"profile-link"}).text(data.name).css("color",`var(--team-${data.team})`).attr("data-name",data.name).on("click",window.__sbg_function_openProfile),$("<span>").text(i18next.t("leaderboard.level",{count:data.level})).css("color",`var(--level-${data.level})`),formatter.format(value),i18next.t(`units.${unit}`));const list=$("<ol>").addClass("leaderboard__list").attr("start",$("#leaderboard__place-pos").text()).append(entry);const stats=window.__sbg_function_jquerypassargs($("<div>"),"$1$ active players<br />$2$ total players",$("#leaderboard__place-active").text(),$("#leaderboard__place-total").text());$(".leaderboard__place > span").empty().append(list).append(stats)}})(window.__sbg_function_drawLeaderboard)}function restoreCUISort(){setCSS(`\n\t\t.inventory__content[data-tab="3"] ~ .inventory__controls > #eui-sort {\n\t\t\tdisplay: none !important;\n\t\t}\n\n\t\t.inventory__content[data-tab="3"] ~ .inventory__controls > .sbgcui_refs-sort-button,\n\t\t.inventory__content[data-tab="3"] ~ .inventory__controls > .sbgcui_refs-sort-select {\n\t\t\tdisplay: block !important;\n\t\t}\n\t`)}function quickRecycleRefs(inventoryContent){setCSS(`\n\t\t.inventory__content[data-tab="3"] .inventory__item {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t}\n\n\t\t.inventory__content[data-tab="3"] .inventory__item-left {\n\t\t\torder: 0;\n\t\t}\n\n\t\t.inventory__content[data-tab="3"] .inventory__item-controls {\n\t\t\tflex-direction: row;\n\t\t}\n\n\t\t.inventory__content[data-tab="3"] .inventory__item-controls button {\n\t\t\twidth: 30px;\n\t\t\tmargin-left: 4px;\n\t\t}\n\n\t\t.inventory__manage-amount[data-tab="3"] {\n\t\t\tdisplay: none;\n\t\t}\n\t`);const inventoryContentEl=inventoryContent.get(0);const events=[...inventoryContentEl.__events.click];events.forEach((event=>inventoryContentEl.removeEventListener("click",event)));$(document).on("click",".inventory__content",(async function(ev){if(!$(ev.target).is(".inventory__ic-manage")){if($(ev.target).is(".inventory__ic-view")){ev.offsetX=0}events.forEach((event=>event(ev)));return}const el=$(ev.target).parents(".inventory__item");const item=(JSON.parse(localStorage.getItem("inventory-cache"))||[]).find((f=>f.g==el.attr("data-guid")));if(!item)return;const fakeEl=$("<input />").addClass("inventory__ma-amount").val(item.a).css({display:"none"});fakeEl.get(0).reportValidity=()=>true;el.append(fakeEl);el.attr("data-tab",item.t);await window.__sbg_function_deleteInventoryItem(el)}))}function makeInfoPopupSemiTransparent(){setCSS(`\n\t\t.info.popup {\n\t\t\tbackground-color: transparent;\n\t\t}\n\t`)}function clearInventoryAfterDiscover(discoverButton){const discoverButtonEl=discoverButton.get(0);const clearInventory=discoverButtonEl.__events.click[1];discoverButtonEl.removeEventListener("click",clearInventory);discoverButtonEl.addEventListener("click",(ev=>{setTimeout((()=>clearInventory(ev)),1e3)}))}function showSecondsForCoolDowns(){window.__sbg_function_timeToString=function(seconds){return seconds>=100?i18next.t("units.min",{count:Math.floor(seconds/60)}):i18next.t("units.sec",{count:seconds})};setCSS(`\n\t\t.discover-progress {\n\t\t\tmax-width: 100%;\n\t\t}\n\t`)}function increaseItemsFont(){setCSS(`\n\t\t.inventory__content:not([data-tab="3"]) {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\t\t\tcounter-reset: section;\n\t\t}\n\n\t\t.inventory__content:not([data-tab="3"]) .inventory__item {\n\t\t\theight: calc((100% - 120px) / 5);\n\t\t\twidth: 50%;\n\t\t\tbox-sizing: border-box;\n\t\t}\n\n\t\t.inventory__content:not([data-tab="3"]) .inventory__item-title {\n\t\t\theight: 2em;\n\t\t\tmargin-top: 0.8em;\n\t\t\tfont-size: 2em;\n\t\t}\n\n\t\t.inventory__content:not([data-tab="3"]) .inventory__item-descr {\n\t\t\tmargin-left: 0;\n\t\t\tmargin-top: -0.8em;\n\t\t\tfont-size: 1.3em !important;\n\t\t}\n\n\t\t.inventory__content:not([data-tab="3"]) .inventory__item-descr::first-letter {\n\t\t\tfont-size: 0;\n\t\t}\n\t`);window.__sbg_constant_ItemTypes=[i18next.t("items.unknown"),"R","X","K"]}function enlargeCoreSlots(){setCSS(`\n\t\t.i-stat__cores {\n\t\t\tpadding: 4px 0;\n\t\t}\n\n\t\t.i-stat__core {\n\t\t\tfont-size: 140%;\n\t\t}\n\t`)}function alignCloseButton(){setCSS(`\n\t\t.info.popup > .popup-close {\n\t\t\tmargin-top: -0.5em;\n\t\t\tmargin-bottom: calc(0.5em - 10px);\n\t\t}\n\t`)}function rearrangeButtons(){setCSS(`\n\t\t.i-stat .i-buttons {\n\t\t\t--discover-left: 0/6;\n\t\t\t--discover-right: 0/6;\n\n\t\t\t--discover-gap: 0.25em;\n\t\t\t--discover-border: 1.9px;\n\t\t\t--discover-parent: calc(0.9 * (100vw - 2 * var(--discover-border)) + 2 * var(--discover-gap));\n\t\t\t--discover-font-size: 1.1em;\n\n\t\t\t--discover-left-offset: calc(var(--discover-left) * (var(--discover-parent) + var(--discover-gap)));\n\t\t\t--discover-right-offset: calc(var(--discover-right) * (var(--discover-parent) + var(--discover-gap)));\n\n\t\t\t--discover-width: calc(var(--discover-parent) - var(--discover-left-offset) - var(--discover-right-offset));\n\n\t\t\t--discover-sibling-left-width: calc(var(--discover-left) * var(--discover-parent) - var(--discover-gap));\n\t\t\t--discover-sibling-right-width: calc(var(--discover-right) * var(--discover-parent) - var(--discover-gap));\n\n\t\t\t--discover-sibling-left-offset: calc(-1 * var(--discover-left-offset) - var(--discover-border));\n\t\t\t--discover-sibling-right-offset: calc(-1 * var(--discover-right-offset) - var(--discover-border));\n\n\t\t\t--discover-alt-button-width: calc(1/6 * (var(--discover-parent) - 2 * var(--discover-gap)) - 0.5 * var(--discover-border));\n\t\t}\n\n\t\t.i-buttons button {\n\t\t\tborder-width: 2px;\n\t\t}\n\n\t\t#discover {\n\t\t\tmargin-left: var(--discover-left-offset);\n\t\t\tmargin-right: var(--discover-right-offset);\n\t\t\twidth: var(--discover-width);\n\t\t}\n\n\t\t.sbgcui_no_loot,\n\t\t.sbgcui_no_refs {\n\t\t\twidth: var(--discover-alt-button-width);\n\t\t\tpadding: 0 calc(0.5 * var(--discover-gap));\n\t\t\tborder-color: currentColor !important;\n\t\t}\n\t`)}function hideCloseButton(){$("#draw").click((ev=>$(".draw-slider-buttons button").css({height:`${$(ev.target).outerHeight()}px`})));$("body").addClass("noclose");rearrangeButtons();setCSS(`\n\t\t.noclose .popup-close,\n\t\t.noclose #inventory__close,\n\t\t.noclose #draw-slider-close {\n\t\t\tdisplay: none !important;\n\t\t}\n\n\t\t.noclose .draw-slider-buttons {\n\t\t\tpadding: 0 calc(5%);\n\t\t\tgap: 0.25em;\n\t\t}\n\n\t\t.noclose .draw-slider-buttons button {\n\t\t\twidth: calc(50% - 0.125em);\n\t\t\tmax-width: none !important;\n\t\t\tpadding: 6px;\n\t\t\tfont-size: 1.1em;\n\t\t}\n\n\t\t.noclose .i-stat .i-buttons {\n\t\t\tmargin: 0;\n\t\t}\n\n\t\t.noclose .i-stat .i-buttons {\n\t\t\t--discover-left: 1/6;\n\t\t}\n\n\t\t.noclose #discover:after {\n\t\t\ttransform: none;\n\t\t\twidth: var(--discover-sibling-left-width);\n\t\t\tleft: var(--discover-sibling-left-offset);\n\t\t\theight: calc(100% + 2 * var(--discover-border));\n\t\t\ttop: calc(-1 * var(--discover-border));\n\t\t\tbox-sizing: border-box;\n\t\t\tline-height: 40px;\n\t\t\tborder: var(--discover-border) solid currentColor;\n\t\t\tcolor: var(--ingress-btn-border-color);\n\t\t\tborder-color: currentColor;\n\t\t\tcontent: ' ';\n\t\t}\n\n\t\t.noclose #discover[data-time]:after {\n\t\t\tcontent: attr(data-time);\n\t\t}\n\n\t\t.noclose #discover[data-time][data-remain]:after {\n\t\t\tcontent: attr(data-time) ' #' attr(data-remain);\n\t\t}\n\n\t\t.noclose #discover[data-time]:after {\n\t\t\tcolor: var(--ingress-btn-disabled-color);\n\t\t\tborder-color: var(--ingress-btn-disabled-accent-color);\n\t\t}\n\n\t\t.noclose #discover[data-time][data-remain]:after {\n\t\t\tbackground: none;\n\t\t\tborder-color: currentColor;\n\t\t}\n\n\t\t.noclose #discover[data-time][data-remain="4"]:after {\n\t\t\tcolor: var(--ingress-btn-border-color);\n\t\t}\n\n\t\t.noclose #discover[data-time][data-remain="3"]:after {\n\t\t\tcolor: white;\n\t\t}\n\n\t\t.noclose #discover[data-time][data-remain="2"]:after {\n\t\t\tcolor: yellow;\n\t\t}\n\n\t\t.noclose #discover[data-time][data-remain="1"]:after {\n\t\t\tcolor: orange;\n\t\t}\n\t`)}function hideRechargeButton(){$("body").addClass("norepair");rearrangeButtons();setCSS(`\n\t\t.norepair #repair,\n\t\t.norepair #eui-repair {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.norepair .i-stat .i-buttons > button:not(#discover) {\n\t\t\twidth: calc(45% + 0.125em);\n\t\t}\n\t`)}function replaceSwipeWithButton(arrow){$("body").addClass("noswipe");rearrangeButtons();arrow.hide();const button=$("<button></button>").addClass("next").html('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="40" height="40" focusable="false"><path d="m15.5 0.932-4.3 4.38 14.5 14.6-14.5 14.5 4.3 4.4 14.6-14.6 4.4-4.3-4.4-4.4-14.6-14.6z"></path></svg>').click((ev=>{const infoPopup=document.querySelector(".info.popup");const touchStartHandler=infoPopup.__events.touchstart.filter((f=>f.name==="touchStartHandler")).shift();const touchMoveHandler=infoPopup.__events.touchmove.filter((f=>f.name==="touchMoveHandler")).shift();const touchEndHandler=infoPopup.__events.touchend.filter((f=>f.name==="touchEndHandler")).shift();touchStartHandler({touches:{length:1,item:()=>({target:infoPopup})}});touchMoveHandler({touches:{item:()=>({clientX:200,clientY:0})}});touchMoveHandler({touches:{item:()=>({clientX:100,clientY:0})}});touchEndHandler();ev.stopPropagation();return false})).appendTo($("#discover"));new MutationObserver((mutations=>mutations.filter((({attributeName:attributeName})=>attributeName==="class")).map((()=>{button.prop("disabled",arrow.hasClass("sbgcui_hidden"))})))).observe(arrow.get(0),{attributes:true});setCSS(`\n\t\t.i-stat .i-buttons .next {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\t.noswipe .i-stat .i-buttons {\n\t\t\t--discover-right: 1/6;\n\t\t}\n\n\t\t.noswipe .i-stat .i-buttons .next {\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\twidth: var(--discover-sibling-right-width);\n\t\t\tright: var(--discover-sibling-left-offset);\n\t\t\theight: calc(100% + 2 * var(--discover-border));\n\t\t\ttop: calc(-1 * var(--discover-border));\n\t\t\tcolor: var(--ingress-btn-color);\n\t\t\tbackground: linear-gradient(to top, var(--ingress-btn-glow-color) 0%, var(--ingress-btn-bg-color) 30%, var(--ingress-btn-bg-color) 70%, var(--ingress-btn-glow-color) 100%), var(--ingress-btn-bg-color);\n\t\t\tborder: 2px solid var(--ingress-btn-border-color);\n\t\t}\n\n\t\t.noswipe .i-stat .i-buttons .next:disabled {\n\t\t\tcolor: var(--ingress-btn-disabled-color);\n\t\t\tbackground: var(--ingress-btn-disabled-bg-color);\n\t\t\tborder-color: var(--ingress-btn-disabled-accent-color);\n\t\t}\n\n\t\t.noswipe .i-stat .i-buttons .next:active {\n\t\t\tfilter: saturate(2);\n\t\t}\n\n\t\t.noswipe .i-stat .i-buttons .next svg {\n\t\t\theight: 16px;\n\t\t\tposition: relative;\n\t\t\ttop: 2px;\n\t\t}\n\n\t\t.noswipe .i-stat .i-buttons .next svg path {\n\t\t\tfill: currentColor;\n\t\t}\n\t`)}function quickToggleInfoButtons(imageBox){const buttons=$("<div></div>").addClass("i-buttons").appendTo(imageBox);function toggleClass(button,cssClass){button.toggleClass("off",!$("body").hasClass(cssClass))}["noclose","norepair","noswipe"].forEach((cssClass=>{const button=$("<button></button>").html(cssClass).appendTo(buttons);toggleClass(button,cssClass);button.click((()=>{$("body").toggleClass(cssClass);toggleClass(button,cssClass)}))}));setCSS(`\n\t\t.i-image-box .i-buttons {\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\tbottom: 0;\n\t\t\tjustify-content: flex-start;\n\t\t\tdirection: ltr;\n\t\t}\n\n\t\t.i-image-box .i-buttons button {\n\t\t\twidth: auto;\n\t\t\tposition: relative;\n\t\t\tz-index: 1;\n\t\t\tfont-size: 0.85em;\n\t\t}\n\n\t\t.i-image-box .i-buttons button.off {\n\t\t\tfilter: saturate(0.15);\n\t\t}\n\t`)}function drawClickPointsToSelect(){(showInfo=>{window.__sbg_function_showInfo=function(data){if(!$("#draw-slider").is(":visible")){showInfo(data)}else{const slide=$(`#draw-slider li[data-point="${data}"]`);if(slide.length>0){(window.__sbg_constant_draw_slider||window.draw_slider).go(slide.index())}}}})(window.__sbg_function_showInfo)}function highlightTargetDrawPoint(){const highlights_source=new ol.source.Vector;const highlights_layer=new ol.layer.Vector({source:highlights_source,name:"highlights",className:"ol-layer__highlights",zIndex:99});window.__sbg_constant_map.addLayer(highlights_layer);(clear=>{window.__sbg_constant_temp_lines_source.clear=function(){clear.apply(this,[...arguments]);highlights_source.clear(...arguments)}})(window.__sbg_constant_temp_lines_source.clear);(manageDrawing=>{window.__sbg_function_manageDrawing=function(){manageDrawing(...arguments);const tempLine=window.__sbg_constant_temp_lines_source.getFeatures()[0];const tempLineCoords=tempLine.getProperties().geometry.getCoordinates();const hlFeature=new ol.Feature({geometry:new ol.geom.Circle(tempLineCoords.pop(),16)});const hlStyle=new ol.style.Style({stroke:new ol.style.Stroke({color:"#F80",width:3})});hlFeature.setStyle(hlStyle);hlFeature.setProperties({point:tempLine.getProperties().point});highlights_source.addFeature(hlFeature)}})(window.__sbg_function_manageDrawing)}function beautifyDrawSliderSort(slider){$("#draw").click((ev=>{slider.css({bottom:`${$(window).height()-$(ev.target).offset().top-$("#draw").outerHeight()}px`});slider.find(".draw-slider-buttons").css({padding:`0 ${$(ev.target).offset().left}px`})}));setCSS(`\n\t\t.draw-slider-wrp {\n\t\t\ttransform: translate(-50%, 0);\n\t\t\ttop: auto;\n\t\t}\n\n\t\t.sbgcui_drawslider_sort {\n\t\t\tposition: static;\n\t\t\ttop: auto;\n\t\t\twidth: auto;\n\t\t}\n\t`)}function autoUpdateLangCache(){const waitForVersion=setInterval((()=>{const currentVersion=window.__sbg_variable_VERSION();if(!currentVersion)return;clearInterval(waitForVersion);const storageKey="__sbg_current_version";const previousVersion=localStorage[storageKey]||"unknown";localStorage[storageKey]=currentVersion;if(previousVersion!==currentVersion){console.log(`Update lang cache from ${previousVersion} version to ${currentVersion} version`);$("#lang-cache").click()}}),50)}